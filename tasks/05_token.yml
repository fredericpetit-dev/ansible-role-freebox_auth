---
- name: "==================== üòé TOKEN : Sauvegarde s√©curis√©e d'un token d'acc√®s g√©n√©ral. ===================="
  ansible.builtin.meta: noop

- name: "[VAULT] :: Cr√©er un vrai fichier Vault sans fichier interm√©diaire"
  ansible.builtin.shell: |
    bash -c '
    set -o pipefail
    {
      echo "id: {{ freebox_auth_vault.data.id | default('') }}"
      echo "revision: {{ freebox_auth_vault.data.revision | default('') }}"
      echo "track: {{ freebox_auth_vault.data.track | default('') }}"
      echo "token: {{ freebox_auth_vault.data.token | default('') }}"
    } | ansible-vault encrypt --vault-password-file=<(echo "{{ freebox_auth_vault.password }}") > "{{ freebox_auth_vault.path }}.enc"
    mv "{{ freebox_auth_vault.path }}.enc" "{{ freebox_auth_vault.path }}"
    '
  args:
    executable: /bin/bash
  changed_when: false
  no_log: true

- name: "[TOKEN] :: V√©rifier les donn√©es d'authentification charg√©es"
  ansible.builtin.debug:
    var: freebox_auth_vault.data
  no_log: true
